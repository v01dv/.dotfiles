#---------------------------------::---------------------------------------------
# File:   $HOME/.tmux.conf
# Author: v01dv
#------------------------------------------------------------------------------

# Rebind prefix to Control + a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

#------------------------------------------------------------------------------
# Settings.
#------------------------------------------------------------------------------

# Disable the delay between an escape key press and subsequent characters.
# This increases Vim responsiveness.
set -sg escape-time 0

# make tmux display things in 256 colors
#set -g default-terminal "screen-256color"

#set -g default-terminal "xterm-256color"
#set-option -ga terminal-overrides ",rxvt-unicode-256color:RGB"
set-option -ga terminal-overrides ",st-256color:Tc"


# increase scrollback lines
set -g history-limit 100000

# Enable vi keys.
set -g status-keys vi
setw -g mode-keys vi

# undo window list centering
set -g status-justify left

# renumber windows sequentially after closing any of them
# set -g renumber-windows on

# Keep window names as I set them
setw -g automatic-rename off

# Monitor window activity. Windows with activity are then highlighted in the
# status line.
setw -g monitor-activity on

# Prevent tmux from displaying "Activity in window X" messages.
set -g visual-activity off

# don't suspend-client
unbind-key C-z

# set window and pane index to 1 (0 by default)
set-option -g base-index 1
setw -g pane-base-index 1

# reload ~/.tmux.conf using PREFIX r
bind r source-file $XDG_CONFIG_HOME/tmux/tmux.conf \; display "Configuration reloaded!"

# Enable mouse mode (tmux 2.1 and above)
set -g mouse on

# Create a new window starting in the current working directory rather than in
# the default directory.
bind C new-window -c "#{pane_current_path}"

# Do not display the original window's name when renaming it. This makes
# renaming faster since one does not need to first erase the original name.
bind , command-prompt -p "(rename-window '#W')" "rename-window '%%'"

# Do the same for sessions.
bind '$' command-prompt -p "(rename-session '#S')" "rename-session '%%'"

# Toggle pane synchronization.
bind S set synchronize-panes

#" https://unix.stackexchange.com/questions/149209/refresh-changed-content-of-file-opened-in-vim/383044#383044
#" https://github.com/tmux-plugins/vim-tmux-focus-events
set -g focus-events on

#------------------------------------------------------------------------------
# Styling.
#------------------------------------------------------------------------------
# set refresh interval for status bar
#set -g status-interval 30

# tmux messages are displayed for 4 seconds
set -g display-time 4000

# refresh 'status-left' and 'status-right' more often
set -g status-interval 5

## COLORSCHEME: gruvbox dark
## From https://github.com/egel/tmux-gruvbox/blob/master/tmux-gruvbox-dark.conf
#set-option -g status "on"


###########################
# Status Bar
###########################

# set refresh interval for status bar
set -g status-interval 30

# center the status bar
set -g status-justify left

# show session, window, pane in left status bar
set -g status-left-length 40
set -g status-left "#[fg=green]#S#[fg=blue] #I:#P #[default]"
#set -g status-left "#S #I:#P #[default]"

# show hostname, date, time, and battery in right status bar
set -g status-right-length 150
set -g status-right "#[fg=green]#H#[default] %m/%d/%y %H:%M"
 #[fg=red]#(battery discharging)#[default]#(battery charging)'

#------------------------------------------------------------------------------
# Key Bindings.
#------------------------------------------------------------------------------

# Smart pane switching with awareness of Vim splits. Now, I can use Ctrl+hjkl
# in both Vim and Tmux (without using the prefix). Based on
# http://www.codeography.com/2013/06/19/navigating-vim-and-tmux-splits.
# Note: I do not use https://github.com/christoomey/vim-tmux-navigator because
#       it does not work when vim is run over ssh.
# Note: The "... || true" part is there to prevent annoying messages when there
#       is no pane to switch into.
# Note: In the grep regular expression, '^vim$' matches Vim run from terminal,
#       and '- VIM$' matches Vim run from Midnight Commander.
bind -n C-h run "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-h) || (tmux select-pane -L || true)"
bind -n C-j run "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-j) || (tmux select-pane -D || true)"
bind -n C-k run "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-k) || (tmux select-pane -U || true)"
bind -n C-l run "(tmux display-message -p '#{pane_title}' | grep -q '\\(- VIM$\\|^vim$\\)' && tmux send-keys C-l) || (tmux select-pane -R || true)"

# Occasionally, it may happen that the above smart-pane-switching keys do not
# work. In such a case, the following bindings allow me to force pane switching
# by using Ctrl+hjkl with prefix.
bind C-h select-pane -L
bind C-j select-pane -D
bind C-k select-pane -U
bind C-l select-pane -R


# Pane splitting.
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

#------------------------------------------------------------------------------
# PLUGINS
#-----------------------------------------------------------------------------
#set -g @plugin 'tmux-plugins/tmux-resurrect'
#set -g @plugin 'tmux-plugins/tmux-sensible'
#set -g @plugin 'tmux-plugins/tmux-pain-control'

set -g @plugin 'tmux-plugins/tpm'

#------------------------------------------------------------------------------
# tmux-plugins/tmux-sessionist
#------------------------------------------------------------------------------
# prefix + g - prompts for session name and switches to it. Performs 'kind-of' name completion.
#              Faster than the built-in prefix + s prompt for long session lists.
# prefix + C (shift + c) - prompt for creating a new session by name.
# prefix + X (shift + x) - kill current session without detaching tmux.
# prefix + S (shift + s) - switches to the last session.
#                          The same as built-in prefix + L that everyone seems to override with some other binding.
# prefix + @ - promote current pane into a new session.
#              Analogous to how prefix + ! breaks current pane to a new window.
# prefix + t<secondary-key> - join currently marked pane (prefix + m) to current session/window, and switch to it
#   secondary-keys:
#       h, -, ": join horizontally
#       v, |, %: join vertically
#       f, @: join full screen
set -g @plugin 'tmux-plugins/tmux-sessionist'


#------------------------------------------------------------------------------
# tmux-plugins/tmux-yank
#------------------------------------------------------------------------------
# Copy to the system clipboard in tmux.
# TODO: install -> sudo apt-get install xsel
# set -g @plugin 'tmux-plugins/tmux-yank'

#------------------------------------------------------------------------------
# tmux-plugins/tmux-continuum
#------------------------------------------------------------------------------
# Continuous saving of tmux environment. Automatic restore when tmux is started.
# Automatic tmux start when computer is turned on.
# Please make sure you have tmux-resurrect installed.
# set -g @plugin 'tmux-plugins/tmux-continuum'

#------------------------------------------------------------------------------
# soyuka/tmux-current-pane-hostname
#------------------------------------------------------------------------------
# Tmux plugin that enables displaying hostname and user of the current pane in your status bar.
#set -g @plugin 'soyuka/tmux-current-pane-hostname'

#------------------------------------------------------------------------------
# Color scheme
#------------------------------------------------------------------------------
#set -g @plugin 'odedlaz/tmux-onedark-theme'

#set -g @plugin 'seebi/tmux-colors-solarized'
#set -g @colors-solarized 'base16'
#set -g @colors-solarized 'dark'

#set -g @plugin 'mshkrebtan/base16-tmux'
set -g @plugin "arcticicestudio/nord-tmux"
#set -g @nord_tmux_show_status_content "0"
set -g @nord_tmux_no_patched_font "1"
set -g status-left-style default

if "test ! -d $XDG_CONFIG_HOME/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm $XDG_CONFIG_HOME/tmux/plugins/tpm && $XDG_CONFIG_HOME/tmux/plugins/tpm/bin/install_plugins'"

# must be at the bottom
run-shell '~/.config/tmux/plugins/tpm/tpm'
