#!/bin/sh
works on any init system
requirements: dmenu, xorg-setxkbmap
kb="$(setxkbmap -query | grep -oP 'layout:\s*\K\w+')" || exit 1

case $BUTTON in
	1) kb_choice="$(awk '/! layout/{flag=1; next} /! variant/{flag=0} flag {print $2, "- " $1}' /usr/share/X11/xkb/rules/base.lst | dmenu -l 15)"
	kb="$(echo "$kb_choice" | awk '{print $3}')"
	setxkbmap "$kb"
	pkill -RTMIN+30 "${STATUSBAR:-dwmblocks}";;
	3) notify-send "‚å®  Keyboard/language module" "$(printf "%s" "\- Current layout: $(setxkbmap -query | grep -oP 'layout:\s*\K\w+')")
- Left click to change keyboard.";;
	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

echo "$kb"


# kb="$(setxkbmap -query | grep -oP 'layout:\s*\K\w+')" || exit 1
#
# case "$kb" in
#
# 	ua) setxkbmap us && echo "US" && kill -64 "$(pidof dwmblocks)" ;;
# 	us) setxkbmap ua && echo "UA" && kill -64 "$(pidof dwmblocks)" ;;
# 	*) exit 1 ;;
# esac
#
# echo "${flag}"
#
#
#
# if [ `setxkbmap -print | grep xkb_symbols | awk '{print $4}' | awk -F"+" '{print $2}'` = us ] ;then
#   echo "EN"; echo "changing to RU..."; setxkbmap ru ;
# else echo "RU"; echo "Changing to US..."; setxkbmap us ; fi
#
